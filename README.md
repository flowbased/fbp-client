fbp-client [![Build Status](https://travis-ci.org/flowbased/fbp-client.svg?branch=master)](https://travis-ci.org/flowbased/fbp-client) [![Coverage Status](https://coveralls.io/repos/github/flowbased/fbp-client/badge.svg?branch=master)](https://coveralls.io/github/flowbased/fbp-client?branch=master)
==========

This library provides a higher level client for interacting with [FBP Protocol](http://flowbased.github.io/fbp-protocol/) runtimes. Underneath it utilizes the transport abstractions provided by [fbp-protocol-client](https://github.com/flowbased/fbp-protocol-client).

## Features

* Fully Promise-based API for interacting with the runtime
* Responses to requests sent to runtime are handled via Promise resolving or rejection
* Messages unrelated to current requests are provided via signal events
* Protocol API is autogenerated from FBP Protocol JSON schemas, ensuring that it changes up to date with protocol features
* All messages to and from runtime are validated against FBP Protocol specification

## Installation

Install this library via NPM:

```shell
$ npm install fbp-client --save
```

Please note that this library is shipped as ES6 code and utilizes native JavaScript Promises. If needed, you can install a Promise polyfill and transpile the code to ES5.

## Usage

Create a client instance for a FBP Protocol runtime definition with:

```javascript
const fbpClient = require('fbp-client');

fbpClient({
  address: 'wss://localhost:3569',
  protocol: 'websocket',
  secret: 'keyboard-cat',
})
  .then((client) => {
    // Use this client instance for further interactions
  });
```

Connect to runtime:

```javascript
client.connect()
  .then(() => {
    // Connected to runtime
  });
```

Send protocol messages:

```javascript
client.runtime.packet({
  graph: 'some-graph-id',
  port: 'in',
  event: 'data',
  payload: 'Hello World!',
})
  .then(() => {
    // Packet was sent
  });
```

## Signals

Events coming from the runtime that are not direct responses to requests made by user are considered to be "signals". To subscribe to all signals coming from the client, use:

```javascript
client.on('signal', signal => console.log(signal));
```

You can also subscribe to signals for only one particular subprotocol with:

```javascript
// Only listen to network protocol
client.on('network', signal => console.log(signal));
```

Messages sent as responses to a request are not emitted as signals.

## Changes

* 0.1.0 (git master)
  - Initial version, support for FBP Protocol version 0.6 and earlier
